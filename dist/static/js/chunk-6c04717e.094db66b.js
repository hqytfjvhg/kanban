(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c04717e"],{"0555":function(e,t,o){"use strict";o("a947")},"271a":function(e,t,o){"use strict";var r=o("cb2d"),i=o("e330"),n=o("577e"),a=o("d6d6"),s=URLSearchParams,l=s.prototype,c=i(l.getAll),d=i(l.has),u=new s("a=1");!u.has("a",2)&&u.has("a",void 0)||r(l,"has",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var r=c(this,e);a(t,1);var i=n(o),s=0;while(s<r.length)if(r[s++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},"2e34":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"main-div",attrs:{id:"main-div"}},[o("div",{staticClass:"main-users"},[o("el-popover",{attrs:{placement:"bottom",title:"标题",width:"300",trigger:"hover",content:"如出现数据无法实时保存,请手动保存。"}},[o("el-link",{staticStyle:{"margin-right":"15px"},attrs:{slot:"reference"},on:{click:function(t){return e.saveExcel()}},slot:"reference"},[e._v("手动保存Excel")])],1),o("el-link",{staticStyle:{"margin-right":"20px"},on:{click:function(t){return e.exportExcel()}}},[e._v("导出Excel")]),o("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[e._l(e.groupUserList,(function(t){return o("li",{key:t.uid},[e._v(e._s(t.uid)),o("span",{staticStyle:{"margin-left":"15px","font-size":"13px",color:"#a39e9e"}},[e._v(e._s(t.time))])])})),o("el-link",{attrs:{slot:"reference",href:"#"},slot:"reference"},[e._v(" 查看当前表格协同用户("+e._s(e.groupUserList.length)+") ")])],2)],1),o("div",{staticClass:"main-luckysheet",style:{width:e.clientWidth,height:e.clientHeight},attrs:{id:"luckysheet"}})])},i=[],n=(o("88a7"),o("271a"),o("5494"),o("751a"));const a={downFile(e,t){let o=n["a"].get(e,{responseType:"blob"}).then(e=>{console.info("请求 blob结果",e);let o=window.URL.createObjectURL(e.data),r=document.createElement("a");return r.href=o,r.download=t,r.click(),window.URL.revokeObjectURL(o),!0}).catch(e=>(console.error("下载文件异常，原因：",e),!1));return o}};var s=a;function l(e){return n["a"].post("/info_screen/excelWork/save",e)}var c={name:"EditContributionEdit",props:{},components:{},data(){return{clientWidth:"",clientHeight:"800px",baseApiUrl:"https://api.board.ifi-cloud.com",baseSocketUrl:"wss://api.board.ifi-cloud.com/websocket/",socketJoinUrl:"",gridKey:null,title:"",groupUserList:[],excelLoadUrl:"https://api.board.ifi-cloud.com/info_screen/excelWork/loadUrl"}},computed:{},watch:{},methods:{async exportExcel(){s.downFile("/info_screen/excelWork/exportExcel/"+this.gridKey,(new Date).getTime()+"-Excel-Export.xlsx").then(e=>{e&&this.$message.success("导出成功")})},async saveExcel(){const e=JSON.stringify(luckysheet.toJson()),t={gridKey:this.gridKey,data:e};l(t).then(()=>{this.$message({message:"手动保存成功！",type:"success"})})},openWebSocket(){const e=this,t=e.baseSocketUrl+e.socketJoinUrl,o=new WebSocket(t);o.addEventListener("open",(function(){console.info("[表格群组] WebSocket服务连接成功"),setInterval(()=>{o.send("1")},6e5)})),o.addEventListener("message",(function(t){const o=JSON.parse(t.data);2502===o.code&&(e.groupUserList=o.data),console.log("[表格群组] 接收到消息 ",o)})),o.onclose=function(){console.log("[表格群组] WebSocket服务关闭.")},o.addEventListener("error",(function(e){console.log("加入 [表格群组] 异常 : ",e)}))}},created(){},mounted(){this.clientWidth=document.getElementById("main-div").clientWidth-30+"px"},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){const e=this.$route.query;if(void 0!==e.gridKey&&""!==e.gridKey){this.gridKey=e.gridKey,this.title=e.title,this.socketJoinUrl=`excel/exit?g=${this.gridKey}&u=${localStorage.getItem("username")}&ly=2`,this.openWebSocket();const t={container:"luckysheet",gridKey:e.gridKey,title:e.title,lang:"zh",loadUrl:this.excelLoadUrl,allowUpdate:!0,updateUrl:`${this.baseSocketUrl}excel/exit?u=${localStorage.getItem("username")}&ly=1`,allowEdit:!0,showtoolbarConfig:{undoRedo:!1,paintFormat:!1,currencyFormat:!1,percentageFormat:!1,numberDecrease:!1,numberIncrease:!1,moreFormats:!1,font:!0,fontSize:!0,bold:!0,italic:!0,strikethrough:!0,underline:!1,textColor:!1,fillColor:!1,border:!1,mergeCell:!1,horizontalAlignMode:!0,verticalAlignMode:!1,textWrapMode:!1,textRotateMode:!1,image:!1,link:!1,chart:!1,postil:!1,pivotTable:!1,function:!0,frozenMode:!1,sortAndFilter:!1,conditionalFormat:!1,dataVerification:!1,splitColumn:!1,screenshot:!1,findAndReplace:!1,protection:!1,print:!1},cellRightClickConfig:{copy:!1,copyAs:!1,paste:!1,insertRow:!1,insertColumn:!1,deleteRow:!1,deleteColumn:!1,deleteCell:!1,hideRow:!1,hideColumn:!1,rowHeight:!1,columnWidth:!1,clear:!1,matrix:!1,sort:!1,filter:!1,chart:!1,image:!1,link:!1,data:!1,cellFormat:!1},forceCalculation:!0,sheetFormulaBar:!0,showsheetbar:!1};luckysheet.create(t)}}},d=c,u=(o("0555"),o("2877")),h=Object(u["a"])(d,r,i,!1,null,"7884b1d0",null);t["default"]=h.exports},5494:function(e,t,o){"use strict";var r=o("83ab"),i=o("e330"),n=o("edd0"),a=URLSearchParams.prototype,s=i(a.forEach);r&&!("size"in a)&&n(a,"size",{get:function(){var e=0;return s(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"88a7":function(e,t,o){"use strict";var r=o("cb2d"),i=o("e330"),n=o("577e"),a=o("d6d6"),s=URLSearchParams,l=s.prototype,c=i(l.append),d=i(l["delete"]),u=i(l.forEach),h=i([].push),p=new s("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&r(l,"delete",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var r=[];u(this,(function(e,t){h(r,{key:t,value:e})})),a(t,1);var i,s=n(e),l=n(o),p=0,f=0,g=!1,m=r.length;while(p<m)i=r[p++],g||i.key===s?(g=!0,d(this,i.key)):f++;while(f<m)i=r[f++],i.key===s&&i.value===l||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},a947:function(e,t,o){},d6d6:function(e,t,o){"use strict";var r=TypeError;e.exports=function(e,t){if(e<t)throw new r("Not enough arguments");return e}},edd0:function(e,t,o){"use strict";var r=o("13d2"),i=o("9bf2");e.exports=function(e,t,o){return o.get&&r(o.get,t,{getter:!0}),o.set&&r(o.set,t,{setter:!0}),i.f(e,t,o)}}}]);